(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{42:function(t,e,a){t.exports=a(93)},60:function(t,e,a){},63:function(t,e,a){},87:function(t,e,a){},91:function(t,e,a){},93:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),s=a(19),c=a.n(s),i=a(1),o=a.n(i),u=a(3),l=a(8),p=a(9),h=a(12),m=a(10),f=a(13),d=a(94),g=a(95),b=a(96),v=a(15),w=a.n(v),y=(a(60),function(){return r.a.createElement(d.a,{fluid:!0,className:"waiter h-100 w-100 p-0 m-0 text-center"},r.a.createElement(g.a,{className:"h-100 w-100 p-0 m-0 align-items-center"},r.a.createElement(b.a,null,r.a.createElement(w.a,{color:"gray",size:10}))))}),E=a(17),k=a(97),x=(a(63),"https://cors-anywhere.herokuapp.com/https://megapolis.bpium.ru/auth/login"),O=function(t){return j.apply(this,arguments)};function j(){return(j=Object(u.a)(o.a.mark(function t(e){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}var S=function(t){function e(){var t,a;Object(l.a)(this,e);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).state={authFailed:!1,waiting:!1},a}return Object(f.a)(e,t),Object(p.a)(e,[{key:"sendAuthRequest",value:function(){var t=Object(u.a)(o.a.mark(function t(e){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({waiting:!0}),t.next=3,O(e);case 3:a=t.sent,this.setState({waiting:!1}),console.log(a),200===a.status?(this.setState({authFailed:!1}),this.props.onAuthSuccess(e)):401===a.status&&this.setState({authFailed:!0});case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"onFormSubmit",value:function(t){this.state.waiting||this.sendAuthRequest(t)}},{key:"render",value:function(){var t=this;return r.a.createElement(d.a,{fluid:!0,className:"auth h-100 w-100 p-0 m-0"},r.a.createElement(g.a,{className:"flex-column h-100 w-100 p-0 m-0 align-items-center justify-content-center"},r.a.createElement(E.a,{onSubmit:function(e){return t.onFormSubmit(e)},initialValues:{}},r.a.createElement(b.a,{className:"px-0"},r.a.createElement("label",null,r.a.createElement(b.a,{className:"px-0 mb-1"},"\u041b\u043e\u0433\u0438\u043d"),r.a.createElement(b.a,{className:"email px-0"},r.a.createElement(E.b,{field:"email",type:"email"})))),r.a.createElement(b.a,{className:"px-0"},r.a.createElement("label",null,r.a.createElement(b.a,{className:"px-0 mb-1"},"\u041f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement(b.a,{className:"password px-0"},r.a.createElement(E.b,{field:"password",type:"password"})))),r.a.createElement(b.a,{className:"warning px-0"},this.state.authFailed?"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c":""),r.a.createElement(b.a,{className:"px-0"},r.a.createElement(k.a,{variant:"success",type:"submit"},this.state.waiting?r.a.createElement(w.a,{size:7,color:"rgba(255,255,255,0.7)"}):"\u0412\u043e\u0439\u0442\u0438")))))}}]),e}(r.a.Component),N=a(39),A=a.n(N),C=a(40),P=a.n(C),R=a(16),T=a.n(R);a(87);var z=function(t){var e=t.points.length,a=20+2*(e-1);a>100&&(a=100);var n,s=[];switch(t.points.forEach(function(t){t.applications.forEach(function(t){s.push(t.criticality)})}),s.length?+function(t){var e={};t.forEach(function(t){e[t]?e[t]++:e[t]=1});var a,n=0;for(var r in e)e[r]>n&&(n=e[r],a=r);return a}(s):null){case 1:n="rgba(186, 57, 57, 0.8)";break;case 2:n="rgba(23, 217, 150, 0.8)";break;case 3:n="rgba(81, 175, 43, 0.8)";break;case 4:n="rgba(84, 213, 255, 0.8)";break;default:n="rgba(81, 175, 43, 0.8)"}return r.a.createElement(T.a,{className:"cluster px-0 justify-content-center align-items-center",style:{height:a,width:a,marginTop:-a/2,marginLeft:-a/2,backgroundColor:n}},r.a.createElement("span",{className:"title"},e))},F=(a(91),function(t){function e(){var t,a;Object(l.a)(this,e);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).state={clusters:[]},a.mapOptions={center:e.defaultProps.center,zoom:e.defaultProps.zoom},a.onMapChange=function(t){a.mapOptions=t,a.createClusters(a.mapOptions)},a}return Object(f.a)(e,t),Object(p.a)(e,[{key:"createClusters",value:function(t){var e=t.bounds?this.getClusters(t).map(function(t){var e=t.wx,a=t.wy,n=t.numPoints,r=t.points;return{lat:a,lng:e,numPoints:n,id:"".concat(n,"_").concat(r[0].id),points:r}}):[];this.setState({clusters:e})}},{key:"getClusters",value:function(t){return P()(this.props.data)(t)}},{key:"componentDidUpdate",value:function(t){t.data.length!==this.props.data.length&&this.onMapChange(this.mapOptions)}},{key:"render",value:function(){var t=this.state.clusters.map(function(t){return r.a.createElement(z,{key:t.id,lat:t.lat,lng:t.lng,points:t.points})});return r.a.createElement(T.a,{fluid:!0,className:"map h-100 w-100 px-0"},r.a.createElement(A.a,{bootstrapURLKeys:{language:"ru",region:"ru"},defaultCenter:e.defaultProps.center,defaultZoom:e.defaultProps.zoom,onChange:this.onMapChange,options:function(t){return{disableDefaultUI:!0}}},t))}}]),e}(r.a.Component));F.defaultProps={center:{lat:61.25,lng:73.38},zoom:4};var D="https://cors-anywhere.herokuapp.com/https://megapolis.bpium.ru/api/v1",q=function(t,e){return I.apply(this,arguments)};function I(){return(I=Object(u.a)(o.a.mark(function t(e,a){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"Content-Type":"application/json"},a&&(n.Authorization="Basic "+btoa("".concat(a.email,":").concat(a.password))),t.next=4,fetch(D+e,{method:"GET",headers:n});case 4:return r=t.sent,t.abrupt("return",r);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}var M=new window.google.maps.Geocoder,G=function(t){return J.apply(this,arguments)};function J(){return(J=Object(u.a)(o.a.mark(function t(e){var a,n,r,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={},n=[],e.branches.forEach(function(t){var e=t.id,r=t.values[6],s=[];n.push(new Promise(function(t,n){M.geocode({address:r,region:"ru"},function(n,c){if("OK"===c){var i=n[0].geometry.location.lat(),o=n[0].geometry.location.lng(),u=n[0].geometry.location_type;"ROOFTOP"===u||"RANGE_INTERPOLATED"===u?a[e]={address:r,lat:i,lng:o,applications:s}:console.log("Incorrect address "+r+" skipped")}else console.log(r,c);t()})}))}),t.next=5,Promise.all(n);case 5:for(s in e.applications.forEach(function(t){var e=t.values[3][0].recordId,n=+t.values[5][0],r=+t.values[10][0];a[e]&&a[e].applications.push({status:n,criticality:r})}),r=[],a)a[s].id=s,r.push(a[s]);return t.abrupt("return",r);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}var L=function(t){function e(){var t,a;Object(l.a)(this,e);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).state={authRequired:!0,error:!1,waiting:!1,data:[]},a}return Object(f.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.checkAccess()}},{key:"onAuthSuccess",value:function(t){this.getData(t)}},{key:"checkAccess",value:function(){var t=Object(u.a)(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({waiting:!0}),t.next=3,q("");case 3:404===(e=t.sent).status?this.onAuthSuccess():401===e.status?this.setState({waiting:!1}):this.onError(e);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getData",value:function(){var t=Object(u.a)(o.a.mark(function t(e){var a,n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=Object.assign({},e),this.setState({waiting:!0}),t.next=4,q("/catalogs/12/records",e);case 4:return t.t0=t.sent,t.next=7,q("/catalogs/11/records",e);case 7:t.t1=t.sent,a={branches:t.t0,applications:t.t1},t.t2=o.a.keys(a);case 10:if((t.t3=t.t2()).done){t.next=22;break}if(n=t.t3.value,200!==a[n].status){t.next=18;break}return t.next=15,a[n].json();case 15:a[n]=t.sent,t.next=20;break;case 18:return this.onError(a[n]),t.abrupt("return");case 20:t.next=10;break;case 22:return t.next=24,G(a);case 24:r=t.sent,this.setState({authRequired:!1,data:r,waiting:!1}),console.log("data",this.state.data);case 27:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"onError",value:function(t){this.setState({error:t})}},{key:"render",value:function(){var t=this,e=!this.state.waiting&&this.state.authRequired?r.a.createElement(S,{key:"auth",onAuthSuccess:function(e){return t.onAuthSuccess(e)}}):null,a=[this.state.waiting?r.a.createElement(y,{key:"waiter"}):null,e,r.a.createElement(F,{key:"map",data:this.state.data})];return this.state.error&&(a=r.a.createElement(U,{res:this.state.error})),a}}]),e}(n.Component),U=function(t){return r.a.createElement("div",null,"".concat(t.res.status," ").concat(t.res.statusText))};c.a.render(r.a.createElement(L,null),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.a25f2ee6.chunk.js.map